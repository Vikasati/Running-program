<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Vikasati Running Program</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body class="bg-gray-100 text-gray-900">
  <div class="container mx-auto p-4 md:p-8 max-w-5xl">
    <header class="text-center my-8 md:my-12">
      <h1 class="text-4xl md:text-6xl font-black text-[#FFC40B] leading-tight">
        Vikasati Running Program
      </h1>
      <p class="text-xl md:text-2xl mt-2 text-[#2D4946] font-semibold">
        5K or 10K Running Plan
      </p>
    </header>

    <div id="milestoneTracker" class="text-center font-semibold text-[#2D4946] mb-4 hidden"></div>

    <section class="bg-white p-6 md:p-8 rounded-xl shadow-lg my-12">
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div>
          <label class="block font-semibold mb-1">Plan Duration</label>
          <select id="planDuration" class="w-full p-2 rounded border">
            <option value="6" selected>6 Weeks</option>
            <option value="12">12 Weeks</option>
          </select>
        </div>
        <div>
          <label class="block font-semibold mb-1">Distance Goal</label>
          <select id="distanceSelect" class="w-full p-2 rounded border">
            <option value="5k">5K</option>
            <option value="10k">10K</option>
          </select>
        </div>
        <div>
          <label class="block font-semibold mb-1">Sessions per Week</label>
          <select id="sessionsPerWeek" class="w-full p-2 rounded border">
            <option value="2">2</option>
            <option value="3" selected>3</option>
          </select>
        </div>
        <div>
          <label class="block font-semibold mb-1">Experience Level</label>
          <select id="experienceLevel" class="w-full p-2 rounded border">
            <option value="beginner">I currently don't run</option>
            <option value="intermediate">I can currently run 1-2 times per week</option>
            <option value="experienced">I consistently run 2-3 times per week</option>
          </select>
        </div>
        <div>
          <label class="block font-semibold mb-1">Current Time (mm:ss)</label>
          <input id="currentTime" type="text" class="w-full p-2 rounded border" placeholder="e.g. 30:00" />
          <div id="currentTimeError" class="text-red-600 text-sm"></div>
        </div>
        <div>
          <label class="block font-semibold mb-1">Goal Time (mm:ss)</label>
          <input id="goalTime" type="text" class="w-full p-2 rounded border" placeholder="e.g. 25:00" />
          <div id="goalTimeError" class="text-red-600 text-sm"></div>
        </div>
      </div>
      <div class="text-center mt-6">
        <button id="generateProgramBtn" class="bg-[#2D4946] text-white px-6 py-3 rounded-xl font-bold">
          Generate Program
        </button>
      </div>
    </section>

    <section id="programOutputSection" class="hidden bg-white p-4 md:p-6 rounded-xl shadow-lg my-12">
      <h2 class="text-2xl md:text-3xl font-bold text-center mb-6">
        Your Weekly Sessions
      </h2>
      <div id="programCardsContainer" class="space-y-6"></div>
      <p class="text-sm text-center text-[#2D4946] mt-6">
        Warm-up: 5-10 min jog/walk. Cool-down: 5-10 min jog/walk. Modify effort based on feel.
      </p>
      <div class="text-center mt-6">
        <button id="downloadPDF" class="bg-[#2D4946] text-white px-6 py-3 rounded-xl font-bold">
          Download PDF
        </button>
      </div>
    </section>
  </div>

  <script>
    function parseTimeToSeconds(t) {
      if (!t || !t.includes(':')) return NaN;
      const [m, s] = t.split(':').map(Number);
      return isNaN(m) || isNaN(s) ? NaN : m * 60 + s;
    }

    function formatPace(secPerKm) {
      const m = Math.floor(secPerKm / 60), s = secPerKm % 60;
      return `${m}:${s.toString().padStart(2, '0')}/km`;
    }

    function rpeLabel(r) {
      const map = {5: 'Steady', 6: 'Comfortable', 7: 'Challenging', 8: 'Hard', 9: 'Very hard'};
      return `RPE ${r} - ${map[r] || 'Unknown'}`;
    }

    function buildPlan(dist, sess, lvl, cur, goal, weeks = 6) {
      const plan = [];
      const curPace = cur / (dist === '10k' ? 10 : 5);   // sec per km
      const goalPace = goal / (dist === '10k' ? 10 : 5); // sec per km

      for (let w = 1; w <= weeks; w++) {
        const weekSessions = [];

        // LONG RUNS
        let longRunMin;
        if (dist === '5k') {
          longRunMin = lvl === 'beginner' ? 30 + w * 2 
                      : lvl === 'intermediate' ? 35 + w * 3 
                      : 40 + w * 4;
        } else {
          longRunMin = lvl === 'beginner' ? 50 + w * 3 
                      : lvl === 'intermediate' ? 60 + w * 3 
                      : 70 + w * 3;
        }
        weekSessions.push({
          icon: '🌿',
          description: `Long Run – ${longRunMin} min`,
          rpe: rpeLabel(6),
          pace: formatPace(curPace + 75),
          duration: `${longRunMin} min`
        });

        // INTERVALS
        let intervalDesc, intervalPace;
        if (dist === '5k') {
          intervalDesc = lvl === 'beginner'
            ? `${3 + w} × 1 min hard, 1 min walk`
            : lvl === 'intermediate'
            ? `${3 + w} × 2 min hard, 90s jog`
            : `${3 + w} × 3 min hard, 90s jog`;
          intervalPace = goalPace - 5;
        } else {
          if (lvl === 'beginner') intervalDesc = `${4 + w} × 600m @ 10K pace, 90s jog`;
          if (lvl === 'intermediate') intervalDesc = `${4 + w} × 800m @ 10K pace, 90s jog`;
          if (lvl === 'experienced') intervalDesc = `${4 + w} × 1km @ 10K pace, 90s jog`;
          intervalPace = goalPace;
        }
        weekSessions.push({
          icon: '⚡',
          description: `Intervals: ${intervalDesc}`,
          rpe: rpeLabel(8),
          pace: formatPace(Math.max(240, Math.round(intervalPace))),
          duration: '20–35 min'
        });

        // TEMPO RUN (only if 3 sessions/week)
        if (+sess === 3) {
          let tempoMin;
          if (dist === '5k') {
            tempoMin = lvl === 'beginner' ? 15 + w
                     : lvl === 'intermediate' ? 20 + w
                     : 25 + w;
          } else {
            tempoMin = lvl === 'beginner' ? 15 + w * 2
                     : lvl === 'intermediate' ? 20 + w * 2
                     : 30 + w * 2;
          }
          weekSessions.push({
            icon: '🏃',
            description: `Tempo Run – ${tempoMin} min`,
            rpe: rpeLabel(7),
            pace: formatPace(goalPace + 15),
            duration: `${tempoMin} min`
          });
        }

        plan.push({ week: w, sessions: weekSessions });
      }
      return plan;
    }

    document.getElementById('generateProgramBtn').addEventListener('click', () => {
      const dist = document.getElementById('distanceSelect').value;
      const sess = document.getElementById('sessionsPerWeek').value;
      const lvl = document.getElementById('experienceLevel').value;
      const cur = parseTimeToSeconds(document.getElementById('currentTime').value);
      const goal = parseTimeToSeconds(document.getElementById('goalTime').value);
      const weeks = parseInt(document.getElementById('planDuration').value);

      if (isNaN(cur) || isNaN(goal)) return;

      const plan = buildPlan(dist, sess, lvl, cur, goal, weeks);
      const container = document.getElementById('programCardsContainer');
      container.innerHTML = '';

      plan.forEach((wk, i) => {
        const card = document.createElement('div');
        card.className = 'border rounded-xl shadow p-4 bg-[#E9EAE6]';
        let html = `<h3 class="text-xl font-bold text-[#2D4946] mb-2">Week ${wk.week}</h3>`;
        wk.sessions.forEach((ls, j) => {
          const id = `week${wk.week}_session${j}`;
          html += `<div class="mb-3 p-3 bg-white rounded-lg shadow-sm">
            <div class="flex justify-between items-center">
              <div>
                <div class="flex items-center gap-2 text-lg font-semibold">${ls.icon} ${ls.description}</div>
                <div class="text-sm mt-1">${ls.rpe}</div>
                <div class="text-sm text-gray-500">Target Pace: ${ls.pace} | Est. Duration: ${ls.duration}</div>
              </div>
              <div>
                <input type="checkbox" id="${id}" class="w-5 h-5 text-[#2D4946]">
              </div>
            </div>
          </div>`;
        });
        card.innerHTML = html;
        container.appendChild(card);
      });

      updateMilestoneProgress(plan);
      document.querySelectorAll('input[type=checkbox]').forEach(cb => {
        cb.addEventListener('change', () => updateMilestoneProgress(plan));
      });

      document.getElementById('programOutputSection').classList.remove('hidden');
    });

    function updateMilestoneProgress(plan) {
      const tracker = document.getElementById('milestoneTracker');
      tracker.classList.remove('hidden');
      tracker.innerHTML = '';
      plan.forEach((week, i) => {
        const allComplete = week.sessions.every((_, j) => {
          return document.getElementById(`week${i + 1}_session${j}`).checked;
        });
        const item = document.createElement('span');
        item.textContent = `Week ${i + 1} ${allComplete ? '✅' : '☐'}`;
        item.className = 'inline-block mx-1';
        tracker.appendChild(item);
      });
    }

    document.getElementById('downloadPDF').addEventListener('click', () => {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF('p', 'pt', 'a4');

      const source = document.getElementById('programOutputSection').cloneNode(true);
      source.querySelector('#downloadPDF')?.remove();

      const container = document.createElement('div');
      container.style.width = '800px';
      container.appendChild(source);
      document.body.appendChild(container);

      doc.html(container, {
        callback: (pdf) => {
          pdf.save('vikasati_running_plan.pdf');
          document.body.removeChild(container);
        },
        x: 20,
        y: 20
      });
    });
  </script>
</body>
</html>
