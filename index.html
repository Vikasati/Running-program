<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Vikasati Running Program</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 text-gray-900">
  <div class="container mx-auto p-4 md:p-8 max-w-5xl">

    <header class="text-center my-8 md:my-12">
      <h1 class="text-4xl md:text-6xl font-black text-[#FFC40B] leading-tight">
        Vikasati Running Program
      </h1>
      <p class="text-xl md:text-2xl mt-2 text-[#2D4946] font-semibold">
        5K or 10K Running Plan
      </p>
    </header>

    <section class="bg-white p-6 md:p-8 rounded-xl shadow-lg my-12">
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div>
          <label class="block font-semibold mb-1">Distance Goal</label>
          <select id="distanceSelect" class="w-full p-2 rounded border">
            <option value="5k">5K</option>
            <option value="10k">10K</option>
          </select>
        </div>
        <div>
          <label class="block font-semibold mb-1">Sessions per Week</label>
          <select id="sessionsPerWeek" class="w-full p-2 rounded border">
            <option value="2">2</option>
            <option value="3" selected>3</option>
            <option value="4">4</option>
          </select>
        </div>
        <div>
          <label class="block font-semibold mb-1">Terrain Type</label>
          <select id="terrainType" class="w-full p-2 rounded border">
            <option value="flat" selected>Flat</option>
            <option value="hilly">Hilly</option>
          </select>
        </div>
        <div>
          <label class="block font-semibold mb-1">Experience Level</label>
          <select id="experienceLevel" class="w-full p-2 rounded border">
            <option value="beginner">Beginner</option>
            <option value="intermediate">Intermediate</option>
            <option value="experienced">Experienced</option>
          </select>
        </div>
        <div>
          <label class="block font-semibold mb-1">Current Time (mm:ss)</label>
          <input id="currentTime" type="text" class="w-full p-2 rounded border" placeholder="e.g. 30:00" />
          <div id="currentTimeError" class="text-red-600 text-sm"></div>
        </div>
        <div>
          <label class="block font-semibold mb-1">Goal Time (mm:ss)</label>
          <input id="goalTime" type="text" class="w-full p-2 rounded border" placeholder="e.g. 25:00" />
          <div id="goalTimeError" class="text-red-600 text-sm"></div>
        </div>
      </div>
      <div class="text-center mt-6">
        <button id="generateProgramBtn" class="bg-[#2D4946] text-white px-6 py-3 rounded-xl font-bold">
          Generate Program
        </button>
      </div>
    </section>

    <section id="summaryPanel" class="hidden text-center text-[#2D4946] mb-8">
      <div class="text-lg font-semibold">
        You selected: <span id="summaryText"></span>
      </div>
      <div class="text-sm">
        Includes warmâ€‘up & coolâ€‘down, RPE, pace per km, timed sessions.
      </div>
      <p class="text-sm mt-2">
        Track progress by checking off sessions. Need more challenge? Adjust your inputs and regenerate anytime.
      </p>
    </section>

    <section id="programOutputSection" class="hidden bg-white p-4 md:p-6 rounded-xl shadow-lg my-12">
      <h2 class="text-2xl md:text-3xl font-bold text-center mb-6">
        Your Weekly Sessions
      </h2>
      <div id="programCardsContainer" class="space-y-6"></div>
      <p class="text-sm text-center text-[#2D4946] mt-6">
        Warmâ€‘up: 5â€‘10â€¯min jog/walk. Coolâ€‘down: 5â€‘10â€¯min jog/walk. Modify effort based on terrain and feel.
      </p>
    </section>
  </div>

  <script>
    let feedbackStore = {};

    function parseTimeToSeconds(t) {
      if (!t || !t.includes(':')) return NaN;
      const [m, s] = t.split(':').map(Number);
      return isNaN(m) || isNaN(s) ? NaN : m * 60 + s;
    }

    function formatPace(secPerKm) {
      const m = Math.floor(secPerKm / 60), s = secPerKm % 60;
      return `${m}:${s.toString().padStart(2, '0')}/km`;
    }

    function formatDuration(min) {
      return `${min} min`;
    }

    function rpeLabel(r) {
      const map = {5: 'Steady', 6: 'Comfortable', 7: 'Challenging', 8: 'Hard', 9: 'Very hard'};
      return `RPE ${r} - ${map[r] || 'Unknown'}`;
    }

    function easyDuration(lvl, goal) {
      const map = {
        beginner: { '5k': '30â€“40 min', '10k': '40â€“50 min' },
        intermediate: { '5k': '35â€“45 min', '10k': '45â€“55 min' },
        experienced: { '5k': '40â€“50 min', '10k': '50â€“65 min' }
      };
      return map[lvl]?.[goal] || '';
    }

    function intervalDescription(week, lvl) {
      const versions = {
        beginner: ['4 Ã— 1â€¯min hard, 1â€¯min walk','5 Ã— 1â€¯min hard, 1â€¯min walk','6 Ã— 1â€¯min hard, 1â€¯min walk','4 Ã— 2â€¯min hard, 1â€¯min walk','5 Ã— 2â€¯min hard, 1â€¯min walk','6 Ã— 2â€¯min hard, 1â€¯min walk'],
        intermediate: ['4 Ã— 2â€¯min hard, 1â€¯min walk','5 Ã— 2â€¯min hard, 1â€¯min walk','4 Ã— 3â€¯min hard, 1â€¯min jog','5 Ã— 3â€¯min hard, 1â€¯min jog','6 Ã— 3â€¯min hard, 1â€¯min jog','4 Ã— 4â€¯min hard, 1â€¯min jog'],
        experienced: ['4 Ã— 3â€¯min threshold, 1â€¯min jog','5 Ã— 3â€¯min threshold, 1â€¯min jog','6 Ã— 3â€¯min threshold, 1â€¯min jog','4 Ã— 4â€¯min threshold, 1â€¯min jog','5 Ã— 4â€¯min threshold, 1â€¯min jog','6 Ã— 4â€¯min threshold, 1â€¯min jog']
      };
      return versions[lvl][Math.min(week - 1, versions[lvl].length - 1)];
    }

    function buildPlan(dist, sess, terr, lvl, cur, goal) {
      const weeks = 6;
      const hill = terr === 'hilly' ? 1 : 0;
      const eff = (cur || 420) / (dist === '10k' ? 10 : 5);
      const goalP = (goal || 360) / (dist === '10k' ? 10 : 5);

      let adjustment = 0;
      const ratings = Object.values(feedbackStore).slice(-3);
      if (ratings.length) {
        const avg = ratings.reduce((sum, v) => sum + v, 0) / ratings.length;
        if (avg < 4) adjustment = -15;
        if (avg > 7) adjustment = 15;
      }

      const plan = [];
      for (let w = 1; w <= weeks; w++) {
        const weekSessions = [];
        for (let s = 1; s <= +sess; s++) {
          let icon = '', desc = '', rpe = 6, pace = eff;
          if (s === 1) {
            const dur = easyDuration(lvl, dist);
            desc = `Long Run â€“ ${dur}`;
            icon = 'ðŸŒ¿'; rpe = 5 + hill; pace = eff + 30;
          } else if (s === 2) {
            const id = intervalDescription(w, lvl);
            desc = `Intervals: ${id}`;
            icon = 'âš¡'; rpe = 7 + hill; pace = goalP - 10 + w * 2;
          } else {
            desc = `Tempo Run â€“ ${formatDuration(20 + w * 2)}`;
            icon = 'ðŸƒ'; rpe = 6 + hill; pace = goalP + 10;
          }
          pace = Math.max(240, Math.round(pace + adjustment));
          weekSessions.push({ icon, description: desc, rpe: rpeLabel(rpe), pace: formatPace(pace) });
        }
        plan.push({ week: w, sessions: weekSessions });
      }
      return plan;
    }

    function validate(curr, goal) {
      let ok = true;
      if (isNaN(parseTimeToSeconds(curr))) {
        document.getElementById('currentTimeError').textContent = 'Invalid';
        ok = false;
      } else document.getElementById('currentTimeError').textContent = '';
      if (isNaN(parseTimeToSeconds(goal))) {
        document.getElementById('goalTimeError').textContent = 'Invalid';
        ok = false;
      } else document.getElementById('goalTimeError').textContent = '';
      return ok;
    }

    document.getElementById('generateProgramBtn').addEventListener('click', () => {
      const dist = document.getElementById('distanceSelect').value;
      const sess = document.getElementById('sessionsPerWeek').value;
      const terr = document.getElementById('terrainType').value;
      const lvl = document.getElementById('experienceLevel').value;
      const cur = parseTimeToSeconds(document.getElementById('currentTime').value);
      const goal = parseTimeToSeconds(document.getElementById('goalTime').value);
      if (!validate(document.getElementById('currentTime').value, document.getElementById('goalTime').value)) return;

      const plan = buildPlan(dist, sess, terr, lvl, cur, goal);
      document.getElementById('summaryText').textContent = `Distance: ${dist.toUpperCase()} | ${sess} sessions/week | ${terr} terrain | ${lvl} runner`;
      document.getElementById('summaryPanel').classList.remove('hidden');

      const container = document.getElementById('programCardsContainer');
      container.innerHTML = '';
      plan.forEach(wk => {
        const card = document.createElement('div');
        card.className = 'border rounded-xl shadow p-4 bg-[#E9EAE6]';
        let html = `<h3 class="text-xl font-bold text-[#2D4946] mb-2">Week ${wk.week}</h3>`;
        wk.sessions.forEach((ls, i) => {
          const id = `week${wk.week}_session${i}`;
          html += `<div class="mb-3 p-3 bg-white rounded-lg shadow-sm">
            <div class="flex justify-between items-center">
              <div>
                <div class="flex items-center gap-2 text-lg font-semibold">${ls.icon} ${ls.description}</div>
                <div class="text-sm mt-1">${ls.rpe}</div>
                <div class="text-sm text-gray-500">Target Pace: ${ls.pace}</div>
              </div>
              <div>
                <input type="checkbox" id="${id}" class="w-5 h-5 text-[#2D4946]">
              </div>
            </div>
            <div class="mt-2">
              <label class="text-sm block mb-1">Rate Effort (1 = too easy, 10 = too hard)</label>
              <input type="range" min="1" max="10" value="5" class="w-full feedback-slider" data-key="${id}">
            </div>
          </div>`;
        });
        card.innerHTML = html;
        container.appendChild(card);
      });

      document.querySelectorAll('.feedback-slider').forEach(slider => {
        slider.addEventListener('input', e => {
          const key = e.target.dataset.key;
          const val = parseInt(e.target.value);
          feedbackStore[key] = val;

          const ratings = Object.values(feedbackStore).slice(-3);
          if (!ratings.length) return;
          const avg = ratings.reduce((sum, r) => sum + r, 0) / ratings.length;
          const adjust = avg < 4 ? 15 : avg > 7 ? -15 : 0;

          const unchecked = document.querySelectorAll('input[type="checkbox"]:not(:checked)');
          for (let i = 0; i < unchecked.length; i++) {
            const id = unchecked[i].id;
            const paceEl = unchecked[i].closest('div.mb-3').querySelector('.text-gray-500');
            if (!paceEl) continue;
            const basePace = paceEl.textContent.match(/\\d+:\\d{2}/);
            if (!basePace) continue;
            const [min, sec] = basePace[0].split(':').map(Number);
            let paceSec = min * 60 + sec + adjust;
            paceSec = Math.max(240, paceSec);
            const newPace = `${Math.floor(paceSec / 60)}:${(paceSec % 60).toString().padStart(2, '0')}/km`;
            paceEl.textContent = `Target Pace: ${newPace}`;
            break;
          }
        });
      });

      document.getElementById('programOutputSection').classList.remove('hidden');
      document.getElementById('programOutputSection').scrollIntoView({ behavior: 'smooth' });
    });
  </script>
</body>
</html>
