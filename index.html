<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Vikasati Running Program</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body class="bg-gray-100 text-gray-900">
  <div class="container mx-auto p-4 md:p-8 max-w-5xl">
    <header class="text-center my-8 md:my-12">
      <h1 class="text-4xl md:text-6xl font-black text-[#FFC40B] leading-tight">
        Vikasati Running Program
      </h1>
      <p class="text-xl md:text-2xl mt-2 text-[#2D4946] font-semibold">
        5K or 10K Running Plan
      </p>
    </header>

    <div id="milestoneTracker" class="text-center font-semibold text-[#2D4946] mb-4 hidden"></div>

    <section class="bg-white p-6 md:p-8 rounded-xl shadow-lg my-12">
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div>
          <label class="block font-semibold mb-1">Distance Goal</label>
          <select id="distanceSelect" class="w-full p-2 rounded border">
            <option value="5k">5K</option>
            <option value="10k">10K</option>
          </select>
        </div>
        <div>
          <label class="block font-semibold mb-1">Sessions per Week (2–3 only)</label>
          <select id="sessionsPerWeek" class="w-full p-2 rounded border">
            <option value="2">2</option>
            <option value="3" selected>3</option>
          </select>
        </div>
        <div>
          <label class="block font-semibold mb-1">Program Length</label>
          <select id="programLength" class="w-full p-2 rounded border">
            <option value="6" selected>6 Weeks</option>
            <option value="12">12 Weeks</option>
          </select>
        </div>
        <div>
          <label class="block font-semibold mb-1">Terrain Type</label>
          <select id="terrainType" class="w-full p-2 rounded border">
            <option value="flat" selected>Flat</option>
            <option value="hilly">Hilly</option>
          </select>
        </div>
        <div>
          <label class="block font-semibold mb-1">Experience Level</label>
          <select id="experienceLevel" class="w-full p-2 rounded border">
            <option value="beginner">Beginner</option>
            <option value="intermediate">Intermediate</option>
            <option value="experienced">Experienced</option>
          </select>
        </div>
        <div>
          <label class="block font-semibold mb-1">Current Time (mm:ss)</label>
          <input id="currentTime" type="text" class="w-full p-2 rounded border" placeholder="e.g. 30:00" />
          <div id="currentTimeError" class="text-red-600 text-sm"></div>
        </div>
        <div>
          <label class="block font-semibold mb-1">Goal Time (mm:ss)</label>
          <input id="goalTime" type="text" class="w-full p-2 rounded border" placeholder="e.g. 25:00" />
          <div id="goalTimeError" class="text-red-600 text-sm"></div>
        </div>
      </div>
      <div class="text-center mt-6">
        <button id="generateProgramBtn" class="bg-[#2D4946] text-white px-6 py-3 rounded-xl font-bold">
          Generate Program
        </button>
      </div>
    </section>

    <section id="summaryPanel" class="hidden text-center text-[#2D4946] mb-8">
      <div class="text-lg font-semibold">
        You selected: <span id="summaryText"></span>
      </div>
      <div class="text-sm">
        Includes warm‑up & cool‑down, RPE, pace per km, timed sessions.
      </div>
    </section>

    <section id="programOutputSection" class="hidden bg-white p-4 md:p-6 rounded-xl shadow-lg my-12">
      <h2 class="text-2xl md:text-3xl font-bold text-center mb-6">
        Your Weekly Sessions
      </h2>
      <div id="programCardsContainer" class="space-y-6"></div>
      <p class="text-sm text-center text-[#2D4946] mt-6">
        Warm‑up: 5‑10 min jog/walk. Cool‑down: 5‑10 min jog/walk.
      </p>
      <div class="text-center mt-6">
        <button id="downloadPDF" class="bg-[#FFC40B] text-black px-6 py-3 rounded-xl font-bold">
          Download PDF
        </button>
      </div>
    </section>
  </div>

  <script>
    const parseTimeToSeconds = (t) => {
      if (!t.includes(':')) return NaN;
      const [m, s] = t.split(':').map(Number);
      return isNaN(m) || isNaN(s) ? NaN : m * 60 + s;
    };

    const formatPace = (s) => `${Math.floor(s / 60)}:${(s % 60).toString().padStart(2, '0')}/km`;
    const rpeLabel = (r) => `RPE ${r} - ${['', '', '', '', '', 'Steady', 'Comfortable', 'Challenging', 'Hard', 'Very hard'][r]}`;

    const easyDuration = (lvl, goal) => ({
      beginner: { '5k': '30–40 min', '10k': '40–50 min' },
      intermediate: { '5k': '35–45 min', '10k': '45–55 min' },
      experienced: { '5k': '40–50 min', '10k': '50–65 min' }
    })[lvl][goal];

    const intervalDescription = (week, lvl) => {
      const versions = {
        beginner: ['4 × 1 min', '5 × 1 min', '6 × 1 min', '4 × 2 min', '5 × 2 min', '6 × 2 min'],
        intermediate: ['4 × 2 min', '5 × 2 min', '4 × 3 min', '5 × 3 min', '6 × 3 min', '4 × 4 min'],
        experienced: ['4 × 3 min', '5 × 3 min', '6 × 3 min', '4 × 4 min', '5 × 4 min', '6 × 4 min']
      };
      return versions[lvl][(week - 1) % 6];
    };

    const buildPlan = (dist, sess, terr, lvl, cur, goal, weeks) => {
      const plan = [];
      const hill = terr === 'hilly' ? 1 : 0;
      const eff = cur / (dist === '10k' ? 10 : 5);
      const goalP = goal / (dist === '10k' ? 10 : 5);

      for (let w = 1; w <= weeks; w++) {
        const weekSessions = [];
        for (let s = 1; s <= +sess; s++) {
          let icon = '🏃', desc = '', rpe = 6, pace = eff;
          if (s === 1) {
            desc = `Long Run – ${easyDuration(lvl, dist)}`;
            icon = '🌿'; rpe = 5 + hill; pace = eff + 30;
          } else if (s === 2) {
            desc = `Intervals: ${intervalDescription(w, lvl)}`;
            icon = '⚡'; rpe = 7 + hill; pace = goalP - 10 + w * 2;
          } else {
            desc = `Tempo Run – ${20 + w * 2} min`;
            rpe = 6 + hill; pace = goalP + 10;
          }
          weekSessions.push({ icon, description: desc, rpe: rpeLabel(rpe), pace: formatPace(Math.max(240, Math.round(pace))) });
        }
        plan.push({ week: w, sessions: weekSessions });
      }
      return plan;
    };

    const updateMilestoneProgress = (plan) => {
      const tracker = document.getElementById('milestoneTracker');
      tracker.classList.remove('hidden');
      tracker.innerHTML = '';
      plan.forEach((week, i) => {
        const allComplete = week.sessions.every((_, j) =>
          document.getElementById(`week${i + 1}_session${j}`).checked
        );
        const item = document.createElement('span');
        item.textContent = `Week ${i + 1} ${allComplete ? '✅' : '☐'}`;
        item.className = 'inline-block mx-1';
        tracker.appendChild(item);
      });
    };

    const attachMilestoneListeners = (plan) => {
      plan.forEach((week, i) => {
        week.sessions.forEach((_, j) => {
          const checkbox = document.getElementById(`week${i + 1}_session${j}`);
          checkbox.addEventListener('change', () => updateMilestoneProgress(plan));
        });
      });
    };

    document.getElementById('generateProgramBtn').addEventListener('click', () => {
      const dist = distanceSelect.value;
      const sess = sessionsPerWeek.value;
      const terr = terrainType.value;
      const lvl = experienceLevel.value;
      const cur = parseTimeToSeconds(currentTime.value);
      const goal = parseTimeToSeconds(goalTime.value);
      const weeks = parseInt(programLength.value);

      if (isNaN(cur) || isNaN(goal)) {
        currentTimeError.textContent = isNaN(cur) ? 'Invalid' : '';
        goalTimeError.textContent = isNaN(goal) ? 'Invalid' : '';
        return;
      }

      currentTimeError.textContent = '';
      goalTimeError.textContent = '';

      const plan = buildPlan(dist, sess, terr, lvl, cur, goal, weeks);
      localStorage.setItem('runningProgram', JSON.stringify({ dist, sess, terr, lvl, cur, goal, weeks, plan }));

      summaryText.textContent = `Distance: ${dist.toUpperCase()} | ${sess} sessions/week | ${terr} terrain | ${lvl} runner | ${weeks} weeks`;
      summaryPanel.classList.remove('hidden');

      const container = document.getElementById('programCardsContainer');
      container.innerHTML = '';
      plan.forEach(wk => {
        const card = document.createElement('div');
        card.className = 'border rounded-xl shadow p-4 bg-[#E9EAE6]';
        let html = `<h3 class="text-xl font-bold text-[#2D4946] mb-2">Week ${wk.week}</h3>`;
        wk.sessions.forEach((ls, i) => {
          const id = `week${wk.week}_session${i}`;
          html += `<div class="mb-3 p-3 bg-white rounded-lg shadow-sm">
            <div class="flex justify-between items-center">
              <div>
                <div class="flex items-center gap-2 text-lg font-semibold">${ls.icon} ${ls.description}</div>
                <div class="text-sm mt-1">${ls.rpe}</div>
                <div class="text-sm text-gray-500">Target Pace: ${ls.pace}</div>
              </div>
              <div><input type="checkbox" id="${id}" class="w-5 h-5 text-[#2D4946]"></div>
            </div>
          </div>`;
        });
        card.innerHTML = html;
        container.appendChild(card);
      });

      attachMilestoneListeners(plan);
      updateMilestoneProgress(plan);
      programOutputSection.classList.remove('hidden');
      programOutputSection.scrollIntoView({ behavior: 'smooth' });
    });

    window.onload = () => {
      const saved = JSON.parse(localStorage.getItem('runningProgram'));
      if (saved) {
        distanceSelect.value = saved.dist;
        sessionsPerWeek.value = saved.sess;
        terrainType.value = saved.terr;
        experienceLevel.value = saved.lvl;
        currentTime.value = `${Math.floor(saved.cur/60)}:${String(saved.cur%60).padStart(2,'0')}`;
        goalTime.value = `${Math.floor(saved.goal/60)}:${String(saved.goal%60).padStart(2,'0')}`;
        programLength.value = saved.weeks;
        generateProgramBtn.click();
      }
    };

    downloadPDF.addEventListener('click', () => {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();
      doc.html(document.getElementById('programOutputSection'), {
        callback: (pdf) => pdf.save('vikasati_running_plan.pdf'),
        x: 10, y: 10, width: 190
      });
    });
  </script>
</body>
</html>
